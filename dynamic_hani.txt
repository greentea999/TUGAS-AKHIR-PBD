/*  DYNAMIC SQL TUGAS
    PEMROGRAMAN BASIS DATA
*/
-- DELETE
CREATE PROCEDURE SP_DELETE_TABLE(
    IN TBL VARCHAR(50),
    IN COL_PK VARCHAR(50),
    IN VAL_PK VARCHAR(50)
)
BEGIN
	SET @SQL=CONCAT("DELETE FROM ", TBL, 
                  "WHERE ",COL_PK,"=",VAL_PK);
    PREPARE STAT FROM @SQL;
    EXECUTE STAT;
END;

-- SEARCH VALUE IN SPECIFIC COLUMN
CREATE PROCEDURE SP_SEARCH_COL(
    IN KEYWORD VARCHAR(50),
    IN TBL VARCHAR(50),
    IN COL_PK VARCHAR(50)
)
BEGIN
	SET @SQL=CONCAT("SELECT * FROM ", TBL, 
                  " WHERE LOWER(",COL_PK,") LIKE LOWER('%",KEYWORD,"%')");
    PREPARE STAT FROM @SQL;
    EXECUTE STAT;
END;

CALL SP_SEARCH_COL("Joko", "Anggota", "NAMA_ANGGOTA");

-- SEARCH VALUE IN ALL COLUMN
CREATE PROCEDURE SP_SEARCH(
	  IN TBL VARCHAR(50),
    IN KEYWORD VARCHAR(50)
)
BEGIN
   	SET @SQL = NULL;

    SELECT GROUP_CONCAT(COLUMN_NAME) INTO @sql
    FROM INFORMATION_SCHEMA.COLUMNS
    WHERE TABLE_NAME = TBL;

    SET @SQL = CONCAT("SELECT * FROM ",TBL, 
                      " WHERE CONCAT_WS(",@SQL,") LIKE LOWER('%",KEYWORD,"%')");

    PREPARE STAT FROM @SQL;
    EXECUTE STAT;
END
CALL SP_SEARCH("Joko", "Anggota");